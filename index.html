<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tamil Accounting Manager PRO - கணக்கு மேலாளர்</title>
    
    <!-- Chart.js for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- html2pdf for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #17a2b8;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
            --border-radius: 12px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Tahoma', Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
            color: var(--primary);
        }
        
        .logo h1 {
            color: var(--primary);
            font-size: 2rem;
        }
        
        .logo span {
            color: var(--secondary);
        }
        
        .stats-bar {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .stat-card {
            background: var(--light);
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
            min-width: 150px;
        }
        
        .stat-card h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .stat-card.income h3 { color: var(--success); }
        .stat-card.expense h3 { color: var(--danger); }
        .stat-card.balance h3 { color: var(--primary); }
        
        /* Main Layout */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 25px;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* Left Panel */
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        /* Account List */
        .accounts-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .section-header h2 {
            color: var(--primary);
            font-size: 1.5rem;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .btn-primary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-info {
            background: var(--info);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        /* Accounts Grid */
        .accounts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .account-card {
            background: white;
            border: 2px solid var(--light);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .account-card:hover {
            border-color: var(--secondary);
            box-shadow: var(--shadow);
            transform: translateY(-5px);
        }
        
        .account-card.active {
            border-color: var(--success);
        }
        
        .account-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .account-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--primary);
        }
        
        .account-date {
            font-size: 0.9rem;
            color: #666;
        }
        
        .account-balance {
            font-size: 1.8rem;
            font-weight: 700;
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            border-radius: 8px;
            background: var(--light);
        }
        
        .account-income { color: var(--success); }
        .account-expense { color: var(--danger); }
        
        .account-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        .account-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 0.85rem;
            flex: 1;
            min-width: 70px;
        }
        
        /* Transactions */
        .transactions-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        .transactions-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .transactions-table th {
            background: var(--primary);
            color: white;
            padding: 12px 15px;
            text-align: left;
        }
        
        .transactions-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--light);
        }
        
        .transactions-table tr:hover {
            background: #f9f9f9;
        }
        
        .income-row td:first-child { border-left: 4px solid var(--success); }
        .expense-row td:first-child { border-left: 4px solid var(--danger); }
        
        /* Right Panel */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        /* Dashboard Cards */
        .dashboard-cards {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .dashboard-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }
        
        .dashboard-card h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Charts */
        .chart-container {
            height: 200px;
            margin-top: 15px;
        }
        
        /* Form Card */
        .form-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--primary);
            font-weight: 600;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--light);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            width: 90%;
            max-width: 600px;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-header h2 {
            color: var(--primary);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        /* Import/Export Section */
        .import-export-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        .file-input-container {
            position: relative;
            margin-bottom: 15px;
        }
        
        .file-input {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-label {
            display: block;
            padding: 15px;
            background: var(--light);
            border: 2px dashed var(--secondary);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-label:hover {
            background: #e3f2fd;
        }
        
        /* Print Styles */
        @media print {
            .no-print {
                display: none !important;
            }
            
            .container {
                width: 100%;
                margin: 0;
                padding: 0;
            }
            
            .account-card {
                break-inside: avoid;
                border: 1px solid #000;
                margin-bottom: 20px;
            }
            
            .transactions-table {
                font-size: 12px;
            }
        }
        
        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        /* Tamil Font Support */
        .tamil-text {
            font-family: 'Latha', 'Tahoma', sans-serif;
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast.error {
            background: var(--danger);
        }
        
        .toast.warning {
            background: var(--warning);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--light);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            border-bottom-color: var(--secondary);
            color: var(--secondary);
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .accounts-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
            }
            
            .stats-bar {
                justify-content: center;
            }
            
            .btn {
                font-size: 12px;
                padding: 8px 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header fade-in">
            <div class="logo">
                <i class="fas fa-calculator"></i>
                <div>
                    <h1 class="tamil-text">கணக்கு மேலாளர் PRO</h1>
                    <p class="tamil-text">Accounting Manager Professional</p>
                </div>
            </div>
            
            <div class="stats-bar">
                <div class="stat-card income">
                    <p class="tamil-text">மொத்த வரவு</p>
                    <h3 id="totalIncome">₹0</h3>
                </div>
                <div class="stat-card expense">
                    <p class="tamil-text">மொத்த செலவு</p>
                    <h3 id="totalExpense">₹0</h3>
                </div>
                <div class="stat-card balance">
                    <p class="tamil-text">மொத்த மீதி</p>
                    <h3 id="totalBalance">₹0</h3>
                </div>
            </div>
        </header>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel -->
            <div class="left-panel">
                <!-- Accounts Section -->
                <section class="accounts-section fade-in">
                    <div class="section-header">
                        <h2 class="tamil-text">கணக்குகள்</h2>
                        <div class="account-buttons">
                            <button class="btn btn-primary" onclick="openAccountModal()">
                                <i class="fas fa-plus"></i> புதிய கணக்கு
                            </button>
                            <button class="btn btn-info" onclick="showImportExportModal()">
                                <i class="fas fa-file-import"></i> இறக்குமதி/ஏற்றுமதி
                            </button>
                        </div>
                    </div>
                    
                    <div class="accounts-grid" id="accountsContainer">
                        <!-- Accounts will be loaded here dynamically -->
                    </div>
                </section>
                
                <!-- Transactions Section -->
                <section class="transactions-section fade-in">
                    <div class="tabs">
                        <div class="tab active" onclick="switchTab('all-transactions')">அனைத்து பரிமாற்றங்கள்</div>
                        <div class="tab" onclick="switchTab('account-transactions')">தற்போதைய கணக்கு</div>
                    </div>
                    
                    <div class="tab-content active" id="all-transactions">
                        <div class="section-header">
                            <h3 class="tamil-text">அனைத்து பரிமாற்றங்கள்</h3>
                            <button class="btn btn-success" onclick="openTransactionModal()">
                                <i class="fas fa-plus"></i> புதிய பரிமாற்றம்
                            </button>
                        </div>
                        
                        <table class="transactions-table">
                            <thead>
                                <tr>
                                    <th class="tamil-text">தேதி</th>
                                    <th class="tamil-text">கணக்கு</th>
                                    <th class="tamil-text">விவரம்</th>
                                    <th class="tamil-text">வரவு</th>
                                    <th class="tamil-text">செலவு</th>
                                    <th class="tamil-text">செயல்கள்</th>
                                </tr>
                            </thead>
                            <tbody id="allTransactionsTable">
                                <!-- All transactions will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="account-transactions">
                        <div class="section-header">
                            <h3 class="tamil-text" id="currentAccountTitle">தற்போதைய கணக்கு பரிமாற்றங்கள்</h3>
                            <button class="btn btn-success" onclick="openTransactionModal()">
                                <i class="fas fa-plus"></i> புதிய பரிமாற்றம்
                            </button>
                        </div>
                        
                        <table class="transactions-table">
                            <thead>
                                <tr>
                                    <th class="tamil-text">தேதி</th>
                                    <th class="tamil-text">விவரம்</th>
                                    <th class="tamil-text">வரவு</th>
                                    <th class="tamil-text">செலவு</th>
                                    <th class="tamil-text">மீதி</th>
                                    <th class="tamil-text">செயல்கள்</th>
                                </tr>
                            </thead>
                            <tbody id="accountTransactionsTable">
                                <!-- Account transactions will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
            
            <!-- Right Panel -->
            <div class="right-panel">
                <!-- Dashboard Cards -->
                <div class="dashboard-cards">
                    <!-- Summary Card -->
                    <div class="dashboard-card fade-in">
                        <h3 class="tamil-text"><i class="fas fa-chart-pie"></i> சுருக்கம்</h3>
                        <div class="summary-details">
                            <div class="form-group">
                                <p class="tamil-text"><strong>மொத்த கணக்குகள்:</strong> <span id="totalAccounts">0</span></p>
                                <p class="tamil-text"><strong>செயலில் உள்ள கணக்கு:</strong> <span id="activeAccountName">-</span></p>
                                <p class="tamil-text"><strong>இன்றைய பரிமாற்றங்கள்:</strong> <span id="todayTransactions">0</span></p>
                                <p class="tamil-text"><strong>கடைசி புதுப்பிப்பு:</strong> <span id="lastUpdated">-</span></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="dashboard-card fade-in">
                        <h3 class="tamil-text"><i class="fas fa-bolt"></i> விரைவு செயல்கள்</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
                            <button class="btn btn-primary btn-small" onclick="openAccountModal()">
                                <i class="fas fa-wallet"></i> கணக்கு சேர்
                            </button>
                            <button class="btn btn-success btn-small" onclick="openTransactionModal()">
                                <i class="fas fa-exchange-alt"></i> பரிமாற்றம் சேர்
                            </button>
                            <button class="btn btn-warning btn-small" onclick="generatePDFReport()">
                                <i class="fas fa-file-pdf"></i> PDF ரிப்போர்ட்
                            </button>
                            <button class="btn btn-info btn-small" onclick="shareViaWhatsApp()">
                                <i class="fab fa-whatsapp"></i> WhatsApp-ல் அனுப்பு
                            </button>
                            <button class="btn btn-small" onclick="printReport()" style="background: var(--primary); color: white;">
                                <i class="fas fa-print"></i> அச்சிடு
                            </button>
                            <button class="btn btn-danger btn-small" onclick="clearAllData()">
                                <i class="fas fa-trash"></i> அனைத்தும் நீக்கு
                            </button>
                        </div>
                    </div>
                    
                    <!-- Charts -->
                    <div class="dashboard-card fade-in">
                        <h3 class="tamil-text"><i class="fas fa-chart-bar"></i> நிதி விளக்கப்படம்</h3>
                        <div class="chart-container">
                            <canvas id="financeChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">செயல்பாடு வெற்றிகரமாக!</span>
    </div>
    
    <!-- Account Modal -->
    <div class="modal" id="accountModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="tamil-text" id="accountModalTitle">புதிய கணக்கு</h2>
                <button class="close-modal" onclick="closeAccountModal()">&times;</button>
            </div>
            <form id="accountForm">
                <div class="form-group">
                    <label class="tamil-text" for="accountName">கணக்கு பெயர் *</label>
                    <input type="text" id="accountName" class="form-control" required placeholder="எ.கா: வங்கி கணக்கு, பணப்பை">
                </div>
                
                <div class="form-group">
                    <label class="tamil-text" for="initialBalance">ஆரம்ப மீதி</label>
                    <input type="number" id="initialBalance" class="form-control" value="0" step="0.01">
                </div>
                
                <div class="form-group">
                    <label class="tamil-text" for="accountColor">கணக்கு நிறம்</label>
                    <input type="color" id="accountColor" class="form-control" value="#3498db">
                </div>
                
                <div class="form-group">
                    <label class="tamil-text" for="accountDescription">விளக்கம்</label>
                    <textarea id="accountDescription" class="form-control" rows="3" placeholder="கணக்கு பற்றிய குறிப்புகள்"></textarea>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 25px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        <i class="fas fa-save"></i> சேமிக்கவும்
                    </button>
                    <button type="button" class="btn btn-danger" onclick="closeAccountModal()" style="flex: 1;">
                        <i class="fas fa-times"></i> ரத்து
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Transaction Modal -->
    <div class="modal" id="transactionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="tamil-text" id="transactionModalTitle">புதிய பரிமாற்றம்</h2>
                <button class="close-modal" onclick="closeTransactionModal()">&times;</button>
            </div>
            <form id="transactionForm">
                <div class="form-group">
                    <label class="tamil-text" for="transactionAccount">கணக்கு *</label>
                    <select id="transactionAccount" class="form-control" required>
                        <!-- Accounts will be loaded here -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="tamil-text" for="transactionDate">தேதி *</label>
                    <input type="date" id="transactionDate" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label class="tamil-text" for="transactionDescription">விவரம் *</label>
                    <input type="text" id="transactionDescription" class="form-control" required placeholder="பரிமாற்ற விவரம்">
                </div>
                
                <div class="form-group">
                    <label class="tamil-text" for="transactionAmount">தொகை *</label>
                    <input type="number" id="transactionAmount" class="form-control" required step="0.01" min="0">
                </div>
                
                <div class="form-group">
                    <label class="tamil-text">வகை *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="transactionType" value="income" checked>
                            <span class="tamil-text">வரவு</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="transactionType" value="expense">
                            <span class="tamil-text">செலவு</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="tamil-text" for="transactionCategory">வகைப்பாடு</label>
                    <select id="transactionCategory" class="form-control">
                        <option value="">தேர்ந்தெடுக்கவும்</option>
                        <option value="சம்பளம்">சம்பளம்</option>
                        <option value="வியாபாரம்">வியாபாரம்</option>
                        <option value="கடன்">கடன்</option>
                        <option value="உணவு">உணவு</option>
                        <option value="பயணம்">பயணம்</option>
                        <option value="மருத்துவம்">மருத்துவம்</option>
                        <option value="கல்வி">கல்வி</option>
                        <option value="வீட்டு செலவு">வீட்டு செலவு</option>
                        <option value="வாகனம்">வாகனம்</option>
                        <option value="விடுமுறை">விடுமுறை</option>
                        <option value="மற்றவை">மற்றவை</option>
                    </select>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 25px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        <i class="fas fa-check"></i> சேர்க்கவும்
                    </button>
                    <button type="button" class="btn btn-danger" onclick="closeTransactionModal()" style="flex: 1;">
                        <i class="fas fa-times"></i> ரத்து
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Import/Export Modal -->
    <div class="modal" id="importExportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="tamil-text">இறக்குமதி / ஏற்றுமதி</h2>
                <button class="close-modal" onclick="closeImportExportModal()">&times;</button>
            </div>
            
            <div class="tabs" style="margin-top: 20px;">
                <div class="tab active" onclick="switchImportExportTab('export')">ஏற்றுமதி</div>
                <div class="tab" onclick="switchImportExportTab('import')">இறக்குமதி</div>
                <div class="tab" onclick="switchImportExportTab('backup')">காப்புப்பிரதி</div>
            </div>
            
            <!-- Export Tab -->
            <div class="tab-content active" id="export-tab">
                <h3 class="tamil-text" style="margin: 20px 0;"><i class="fas fa-download"></i> தரவு ஏற்றுமதி</h3>
                <p class="tamil-text" style="margin-bottom: 20px; color: #666;">
                    உங்கள் அனைத்து கணக்கு மற்றும் பரிமாற்ற தரவை JSON கோப்பாக பதிவிறக்கம் செய்யலாம்.
                </p>
                
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <button class="btn btn-primary" onclick="exportAllData()">
                        <i class="fas fa-file-download"></i> அனைத்து தரவையும் ஏற்றுமதி செய்
                    </button>
                    
                    <button class="btn btn-success" onclick="exportCurrentAccountPDF()">
                        <i class="fas fa-file-pdf"></i> தற்போதைய கணக்கு PDF
                    </button>
                    
                    <button class="btn btn-warning" onclick="exportAllAccountsPDF()">
                        <i class="fas fa-file-pdf"></i> அனைத்து கணக்குகள் PDF
                    </button>
                </div>
            </div>
            
            <!-- Import Tab -->
            <div class="tab-content" id="import-tab">
                <h3 class="tamil-text" style="margin: 20px 0;"><i class="fas fa-upload"></i> தரவு இறக்குமதி</h3>
                <p class="tamil-text" style="margin-bottom: 20px; color: #666;">
                    முன்பு ஏற்றுமதி செய்த JSON கோப்பை இறக்குமதி செய்யலாம்.
                </p>
                
                <div class="file-input-container">
                    <input type="file" id="importFile" class="file-input" accept=".json">
                    <label for="importFile" class="file-label">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p class="tamil-text">JSON கோப்பை இங்கே இழுத்து விடவும் அல்லது கிளிக் செய்யவும்</p>
                        <small style="color: #666;">.json கோப்புகள் மட்டும்</small>
                    </label>
                </div>
                
                <div class="form-group">
                    <label class="tamil-text">
                        <input type="checkbox" id="replaceData" checked>
                        தற்போதைய தரவை மாற்று
                    </label>
                    <small style="color: #666; display: block; margin-top: 5px;">
                        ✓ இது உங்கள் தற்போதைய தரவை மாற்றும். காப்புப்பிரதி எடுத்த பிறகு செய்யவும்.
                    </small>
                </div>
                
                <button class="btn btn-success" onclick="importData()" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-file-import"></i> தரவு இறக்குமதி செய்
                </button>
            </div>
            
            <!-- Backup Tab -->
            <div class="tab-content" id="backup-tab">
                <h3 class="tamil-text" style="margin: 20px 0;"><i class="fas fa-database"></i> தரவு காப்புப்பிரதி</h3>
                <p class="tamil-text" style="margin-bottom: 20px; color: #666;">
                    உங்கள் தரவின் காப்புப்பிரதியை எடுக்கவும் அல்லது மீட்டெடுக்கவும்.
                </p>
                
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <button class="btn btn-primary" onclick="createBackup()">
                        <i class="fas fa-save"></i> காப்புப்பிரதி எடு
                    </button>
                    
                    <button class="btn btn-warning" onclick="restoreBackup()">
                        <i class="fas fa-undo"></i> காப்புப்பிரதியிலிருந்து மீட்டெடு
                    </button>
                    
                    <button class="btn btn-info" onclick="viewBackupInfo()">
                        <i class="fas fa-info-circle"></i> காப்புப்பிரதி தகவல்
                    </button>
                </div>
                
                <div id="backupInfo" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; display: none;">
                    <!-- Backup info will be shown here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application State
        let accounts = [];
        let transactions = [];
        let currentAccountId = null;
        let financeChart = null;
        let lastUpdated = new Date();
        
        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupDate();
            renderAccounts();
            renderAllTransactions();
            renderAccountTransactions();
            updateDashboard();
            initializeCharts();
            updateLastUpdated();
            
            // Setup file import
            document.getElementById('importFile').addEventListener('change', handleFileSelect);
        });
        
        // Set today's date as default
        function setupDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('transactionDate').value = today;
        }
        
        // Load data from localStorage - FIXED VERSION
        function loadData() {
            try {
                const savedAccounts = localStorage.getItem('tamilAccountsPro');
                const savedTransactions = localStorage.getItem('tamilTransactionsPro');
                
                if (savedAccounts) {
                    accounts = JSON.parse(savedAccounts);
                    // Ensure each account has required fields
                    accounts = accounts.map(account => ({
                        id: account.id || Date.now().toString(),
                        name: account.name || 'பெயர் இல்லை',
                        initialBalance: parseFloat(account.initialBalance) || 0,
                        color: account.color || '#3498db',
                        description: account.description || '',
                        createdAt: account.createdAt || new Date().toISOString(),
                        updatedAt: account.updatedAt || new Date().toISOString()
                    }));
                }
                
                if (savedTransactions) {
                    transactions = JSON.parse(savedTransactions);
                    // Ensure each transaction has required fields
                    transactions = transactions.map(transaction => ({
                        id: transaction.id || Date.now().toString(),
                        accountId: transaction.accountId || (accounts[0]?.id || ''),
                        date: transaction.date || new Date().toISOString().split('T')[0],
                        description: transaction.description || 'விவரம் இல்லை',
                        amount: parseFloat(transaction.amount) || 0,
                        type: transaction.type === 'income' || transaction.type === 'expense' ? transaction.type : 'income',
                        category: transaction.category || '',
                        createdAt: transaction.createdAt || new Date().toISOString(),
                        updatedAt: transaction.updatedAt || new Date().toISOString()
                    }));
                }
                
                // Set first account as active if none selected
                if (accounts.length > 0 && !currentAccountId) {
                    currentAccountId = accounts[0].id;
                }
                
                showToast('தரவு ஏற்றப்பட்டது!', 'success');
            } catch (error) {
                console.error('Error loading data:', error);
                showToast('தரவு ஏற்றத்தில் பிழை!', 'error');
            }
        }
        
        // Save data to localStorage - FIXED VERSION
        function saveData() {
            try {
                localStorage.setItem('tamilAccountsPro', JSON.stringify(accounts));
                localStorage.setItem('tamilTransactionsPro', JSON.stringify(transactions));
                updateLastUpdated();
                showToast('தரவு சேமிக்கப்பட்டது!', 'success');
            } catch (error) {
                console.error('Error saving data:', error);
                showToast('தரவு சேமிப்பில் பிழை!', 'error');
            }
        }
        
        // Account Functions
        function openAccountModal(accountId = null) {
            const modal = document.getElementById('accountModal');
            const title = document.getElementById('accountModalTitle');
            const form = document.getElementById('accountForm');
            
            if (accountId) {
                // Edit mode
                title.textContent = 'கணக்கு திருத்தம்';
                const account = accounts.find(acc => acc.id === accountId);
                if (account) {
                    document.getElementById('accountName').value = account.name;
                    document.getElementById('initialBalance').value = account.initialBalance;
                    document.getElementById('accountColor').value = account.color;
                    document.getElementById('accountDescription').value = account.description || '';
                    
                    form.dataset.editId = accountId;
                }
            } else {
                // Create mode
                title.textContent = 'புதிய கணக்கு';
                form.reset();
                document.getElementById('accountColor').value = '#3498db';
                document.getElementById('initialBalance').value = '0';
                delete form.dataset.editId;
            }
            
            modal.style.display = 'flex';
        }
        
        function closeAccountModal() {
            document.getElementById('accountModal').style.display = 'none';
            document.getElementById('accountForm').reset();
        }
        
        // Handle account form submission - FIXED
        document.getElementById('accountForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = e.target;
            const accountId = form.dataset.editId || 'acc_' + Date.now();
            const isEditMode = !!form.dataset.editId;
            
            const account = {
                id: accountId,
                name: document.getElementById('accountName').value.trim(),
                initialBalance: parseFloat(document.getElementById('initialBalance').value) || 0,
                color: document.getElementById('accountColor').value,
                description: document.getElementById('accountDescription').value.trim(),
                createdAt: isEditMode ? accounts.find(acc => acc.id === accountId)?.createdAt || new Date().toISOString() : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            if (!account.name) {
                showToast('கணக்கு பெயர் கட்டாயம்!', 'error');
                return;
            }
            
            if (isEditMode) {
                // Update existing account
                const index = accounts.findIndex(acc => acc.id === accountId);
                if (index !== -1) {
                    accounts[index] = account;
                }
            } else {
                // Add new account
                accounts.push(account);
                // Set as active if it's the first account
                if (accounts.length === 1) {
                    currentAccountId = accountId;
                }
            }
            
            saveData();
            renderAccounts();
            closeAccountModal();
            updateDashboard();
            
            showToast(isEditMode ? 'கணக்கு திருத்தப்பட்டது!' : 'கணக்கு சேர்க்கப்பட்டது!', 'success');
        });
        
        // Transaction Functions
        function openTransactionModal(transactionId = null) {
            const modal = document.getElementById('transactionModal');
            const title = document.getElementById('transactionModalTitle');
            const accountSelect = document.getElementById('transactionAccount');
            
            // Populate accounts dropdown
            accountSelect.innerHTML = '';
            accounts.forEach(account => {
                const option = document.createElement('option');
                option.value = account.id;
                option.textContent = account.name;
                if (account.id === currentAccountId) {
                    option.selected = true;
                }
                accountSelect.appendChild(option);
            });
            
            if (transactionId) {
                // Edit mode
                title.textContent = 'பரிமாற்றம் திருத்தம்';
                const transaction = transactions.find(t => t.id === transactionId);
                if (transaction) {
                    document.getElementById('transactionDate').value = transaction.date;
                    document.getElementById('transactionDescription').value = transaction.description;
                    document.getElementById('transactionAmount').value = transaction.amount;
                    document.getElementById('transactionAccount').value = transaction.accountId;
                    document.querySelector(`input[name="transactionType"][value="${transaction.type}"]`).checked = true;
                    document.getElementById('transactionCategory').value = transaction.category || '';
                    
                    document.getElementById('transactionForm').dataset.editId = transactionId;
                }
            } else {
                // Create mode
                title.textContent = 'புதிய பரிமாற்றம்';
                setupDate();
                document.getElementById('transactionForm').reset();
                delete document.getElementById('transactionForm').dataset.editId;
                
                // Set current account if available
                if (currentAccountId) {
                    document.getElementById('transactionAccount').value = currentAccountId;
                }
            }
            
            modal.style.display = 'flex';
        }
        
        function closeTransactionModal() {
            document.getElementById('transactionModal').style.display = 'none';
            document.getElementById('transactionForm').reset();
            setupDate();
        }
        
        // Handle transaction form submission - FIXED
        document.getElementById('transactionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = e.target;
            const transactionId = form.dataset.editId || 'trx_' + Date.now();
            const isEditMode = !!form.dataset.editId;
            
            const selectedAccountId = document.getElementById('transactionAccount').value;
            if (!selectedAccountId) {
                showToast('கணக்கு தேர்ந்தெடுக்கவும்!', 'error');
                return;
            }
            
            const transaction = {
                id: transactionId,
                accountId: selectedAccountId,
                date: document.getElementById('transactionDate').value,
                description: document.getElementById('transactionDescription').value.trim(),
                amount: parseFloat(document.getElementById('transactionAmount').value) || 0,
                type: document.querySelector('input[name="transactionType"]:checked').value,
                category: document.getElementById('transactionCategory').value,
                createdAt: isEditMode ? transactions.find(t => t.id === transactionId)?.createdAt || new Date().toISOString() : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            if (!transaction.description) {
                showToast('விவரம் கட்டாயம்!', 'error');
                return;
            }
            
            if (transaction.amount <= 0) {
                showToast('தொகை சரியாக இல்லை!', 'error');
                return;
            }
            
            if (isEditMode) {
                // Update existing transaction
                const index = transactions.findIndex(t => t.id === transactionId);
                if (index !== -1) {
                    transactions[index] = transaction;
                }
            } else {
                // Add new transaction
                transactions.push(transaction);
            }
            
            saveData();
            renderAllTransactions();
            renderAccountTransactions();
            closeTransactionModal();
            updateDashboard();
            
            showToast(isEditMode ? 'பரிமாற்றம் திருத்தப்பட்டது!' : 'பரிமாற்றம் சேர்க்கப்பட்டது!', 'success');
        });
        
        // Render accounts - FIXED BALANCE CALCULATION
        function renderAccounts() {
            const container = document.getElementById('accountsContainer');
            container.innerHTML = '';
            
            accounts.forEach(account => {
                const accountTransactions = transactions.filter(t => t.accountId === account.id);
                const income = accountTransactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const expense = accountTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                // CORRECTED: Add initialBalance to balance calculation
                const balance = account.initialBalance + income - expense;
                
                const card = document.createElement('div');
                card.className = `account-card ${account.id === currentAccountId ? 'active' : ''}`;
                card.style.borderLeft = `5px solid ${account.color}`;
                card.innerHTML = `
                    <div class="account-header">
                        <div class="account-title">${account.name}</div>
                        <div class="account-date">${new Date(account.createdAt).toLocaleDateString('ta-IN')}</div>
                    </div>
                    <div class="account-balance ${balance >= 0 ? 'account-income' : 'account-expense'}">
                        ₹${balance.toFixed(2)}
                    </div>
                    <div class="account-stats">
                        <div><i class="fas fa-arrow-up" style="color: var(--success);"></i> ₹${income.toFixed(2)}</div>
                        <div><i class="fas fa-arrow-down" style="color: var(--danger);"></i> ₹${expense.toFixed(2)}</div>
                        <div><i class="fas fa-piggy-bank" style="color: var(--secondary);"></i> ₹${account.initialBalance.toFixed(2)}</div>
                    </div>
                    <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">${account.description || ''}</p>
                    <div class="account-actions">
                        <button class="btn btn-primary btn-small" onclick="setActiveAccount('${account.id}')">
                            <i class="fas fa-eye"></i> காண்க
                        </button>
                        <button class="btn btn-success btn-small" onclick="openAccountModal('${account.id}')">
                            <i class="fas fa-edit"></i> திருத்து
                        </button>
                        <button class="btn btn-warning btn-small" onclick="exportAccountPDF('${account.id}')">
                            <i class="fas fa-file-pdf"></i> PDF
                        </button>
                        <button class="btn btn-danger btn-small" onclick="deleteAccount('${account.id}')">
                            <i class="fas fa-trash"></i> நீக்கு
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
            
            // If no accounts
            if (accounts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666; grid-column: 1 / -1;">
                        <i class="fas fa-wallet" style="font-size: 3rem; margin-bottom: 20px;"></i>
                        <p class="tamil-text" style="font-size: 1.2rem; margin-bottom: 10px;">கணக்குகள் இல்லை</p>
                        <p class="tamil-text">முதல் கணக்கை உருவாக்க "புதிய கணக்கு" பட்டனை கிளிக் செய்யவும்</p>
                    </div>
                `;
            }
        }
        
        // Render all transactions
        function renderAllTransactions() {
            const table = document.getElementById('allTransactionsTable');
            table.innerHTML = '';
            
            // Sort by date (newest first)
            const sortedTransactions = [...transactions].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedTransactions.forEach(transaction => {
                const account = accounts.find(acc => acc.id === transaction.accountId);
                const accountName = account ? account.name : 'தெரியவில்லை';
                
                const row = document.createElement('tr');
                row.className = transaction.type === 'income' ? 'income-row' : 'expense-row';
                
                row.innerHTML = `
                    <td>${new Date(transaction.date).toLocaleDateString('ta-IN')}</td>
                    <td><span style="color: ${account ? account.color : '#666'}">●</span> ${accountName}</td>
                    <td>
                        <div>${transaction.description}</div>
                        ${transaction.category ? `<small style="color: #666;">${transaction.category}</small>` : ''}
                    </td>
                    <td style="color: var(--success); font-weight: bold;">${transaction.type === 'income' ? '₹' + transaction.amount.toFixed(2) : '-'}</td>
                    <td style="color: var(--danger); font-weight: bold;">${transaction.type === 'expense' ? '₹' + transaction.amount.toFixed(2) : '-'}</td>
                    <td>
                        <button class="btn btn-success btn-small" onclick="openTransactionModal('${transaction.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-small" onclick="deleteTransaction('${transaction.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
            
            // If no transactions
            if (transactions.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-file-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p class="tamil-text">பரிமாற்றங்கள் இல்லை</p>
                    </td>
                `;
                table.appendChild(row);
            }
        }
        
        // Render account-specific transactions - FIXED RUNNING BALANCE
        function renderAccountTransactions() {
            const table = document.getElementById('accountTransactionsTable');
            const title = document.getElementById('currentAccountTitle');
            table.innerHTML = '';
            
            const activeAccount = accounts.find(acc => acc.id === currentAccountId);
            if (!activeAccount) {
                title.textContent = 'கணக்கு தேர்ந்தெடுக்கவும்';
                return;
            }
            
            title.textContent = `${activeAccount.name} - பரிமாற்றங்கள்`;
            
            const accountTransactions = transactions.filter(t => t.accountId === currentAccountId);
            
            // Sort by date (oldest to newest for running balance)
            const sortedTransactions = [...accountTransactions].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            let runningBalance = activeAccount.initialBalance;
            
            sortedTransactions.forEach(transaction => {
                // Update running balance
                if (transaction.type === 'income') {
                    runningBalance += transaction.amount;
                } else {
                    runningBalance -= transaction.amount;
                }
                
                const row = document.createElement('tr');
                row.className = transaction.type === 'income' ? 'income-row' : 'expense-row';
                
                row.innerHTML = `
                    <td>${new Date(transaction.date).toLocaleDateString('ta-IN')}</td>
                    <td>
                        <div>${transaction.description}</div>
                        ${transaction.category ? `<small style="color: #666;">${transaction.category}</small>` : ''}
                    </td>
                    <td style="color: var(--success); font-weight: bold;">${transaction.type === 'income' ? '₹' + transaction.amount.toFixed(2) : '-'}</td>
                    <td style="color: var(--danger); font-weight: bold;">${transaction.type === 'expense' ? '₹' + transaction.amount.toFixed(2) : '-'}</td>
                    <td style="font-weight: bold; color: ${runningBalance >= 0 ? 'var(--success)' : 'var(--danger)'}">
                        ₹${runningBalance.toFixed(2)}
                    </td>
                    <td>
                        <button class="btn btn-success btn-small" onclick="openTransactionModal('${transaction.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-small" onclick="deleteTransaction('${transaction.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                table.appendChild(row);
            });
            
            // If no transactions
            if (accountTransactions.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" style="text-align: center; padding: 40px; color: #666;">
                        <i class="fas fa-file-alt" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p class="tamil-text">இந்த கணக்கில் பரிமாற்றங்கள் இல்லை</p>
                        <p class="tamil-text" style="font-size: 0.9rem; margin-top: 10px;">ஆரம்ப மீதி: ₹${activeAccount.initialBalance.toFixed(2)}</p>
                    </td>
                `;
                table.appendChild(row);
            }
        }
        
        // Set active account
        function setActiveAccount(accountId) {
            currentAccountId = accountId;
            renderAccounts();
            renderAccountTransactions();
            updateDashboard();
            showToast('கணக்கு மாற்றப்பட்டது!', 'success');
        }
        
        // Delete account
        function deleteAccount(accountId) {
            const account = accounts.find(acc => acc.id === accountId);
            if (!account) return;
            
            if (confirm(`"${account.name}" கணக்கை நிச்சயமாக நீக்க விரும்புகிறீர்களா? இதனுடன் தொடர்புடைய ${transactions.filter(t => t.accountId === accountId).length} பரிமாற்றங்களும் நீக்கப்படும்!`)) {
                // Delete account
                accounts = accounts.filter(acc => acc.id !== accountId);
                
                // Delete related transactions
                transactions = transactions.filter(t => t.accountId !== accountId);
                
                // Update current account if deleted
                if (currentAccountId === accountId) {
                    currentAccountId = accounts.length > 0 ? accounts[0].id : null;
                }
                
                saveData();
                renderAccounts();
                renderAllTransactions();
                renderAccountTransactions();
                updateDashboard();
                
                showToast('கணக்கு நீக்கப்பட்டது!', 'success');
            }
        }
        
        // Delete transaction
        function deleteTransaction(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId);
            if (!transaction) return;
            
            if (confirm('இந்த பரிமாற்றத்தை நீக்க விரும்புகிறீர்களா?')) {
                transactions = transactions.filter(t => t.id !== transactionId);
                saveData();
                renderAllTransactions();
                renderAccountTransactions();
                updateDashboard();
                
                showToast('பரிமாற்றம் நீக்கப்பட்டது!', 'success');
            }
        }
        
        // Update dashboard - FIXED CALCULATION
        function updateDashboard() {
            // Calculate totals - INCLUDING INITIAL BALANCES
            let totalIncome = 0;
            let totalExpense = 0;
            
            // Add all initial balances to income
            accounts.forEach(account => {
                totalIncome += account.initialBalance;
            });
            
            // Add transactions
            transactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    totalIncome += transaction.amount;
                } else {
                    totalExpense += transaction.amount;
                }
            });
            
            const totalBalance = totalIncome - totalExpense;
            
            // Update header stats
            document.getElementById('totalIncome').textContent = '₹' + totalIncome.toFixed(2);
            document.getElementById('totalExpense').textContent = '₹' + totalExpense.toFixed(2);
            document.getElementById('totalBalance').textContent = '₹' + totalBalance.toFixed(2);
            
            // Update summary
            document.getElementById('totalAccounts').textContent = accounts.length;
            
            const activeAccount = accounts.find(acc => acc.id === currentAccountId);
            document.getElementById('activeAccountName').textContent = activeAccount ? activeAccount.name : '-';
            
            // Count today's transactions
            const today = new Date().toISOString().split('T')[0];
            const todayCount = transactions.filter(t => t.date === today).length;
            document.getElementById('todayTransactions').textContent = todayCount;
            
            // Update last updated time
            updateLastUpdated();
            
            // Update chart
            updateChart();
        }
        
        // Update last updated time
        function updateLastUpdated() {
            lastUpdated = new Date();
            document.getElementById('lastUpdated').textContent = lastUpdated.toLocaleTimeString('ta-IN');
        }
        
        // Initialize charts
        function initializeCharts() {
            const ctx = document.getElementById('financeChart').getContext('2d');
            financeChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['வரவு', 'செலவு', 'மீதி'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: [
                            'rgba(39, 174, 96, 0.8)',
                            'rgba(231, 76, 60, 0.8)',
                            'rgba(52, 152, 219, 0.8)'
                        ],
                        borderColor: [
                            'rgba(39, 174, 96, 1)',
                            'rgba(231, 76, 60, 1)',
                            'rgba(52, 152, 219, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    family: "'Latha', 'Tahoma', sans-serif"
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update chart
        function updateChart() {
            if (!financeChart) return;
            
            let income = 0;
            let expense = 0;
            
            // Add initial balances to income
            accounts.forEach(account => {
                income += account.initialBalance;
            });
            
            // Add transactions
            transactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    income += transaction.amount;
                } else {
                    expense += transaction.amount;
                }
            });
            
            const balance = income - expense;
            
            financeChart.data.datasets[0].data = [income, expense, balance];
            financeChart.update();
        }
        
        // Tab switching
        function switchTab(tabId) {
            // Update tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Activate selected tab
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }
        
        // Import/Export Functions
        function showImportExportModal() {
            document.getElementById('importExportModal').style.display = 'flex';
            switchImportExportTab('export');
        }
        
        function closeImportExportModal() {
            document.getElementById('importExportModal').style.display = 'none';
        }
        
        function switchImportExportTab(tabId) {
            // Update tabs
            document.querySelectorAll('#importExportModal .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('#importExportModal .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Activate selected tab
            document.querySelector(`#importExportModal .tab[onclick*="${tabId}"]`).classList.add('active');
            document.getElementById(`${tabId}-tab`).classList.add('active');
        }
        
        // Export all data as JSON
        function exportAllData() {
            const data = {
                accounts: accounts,
                transactions: transactions,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `tamil_accounting_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('அனைத்து தரவும் ஏற்றுமதி செய்யப்பட்டது!', 'success');
        }
        
        // Handle file selection for import
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.name.endsWith('.json')) {
                showToast('JSON கோப்புகள் மட்டும்!', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Validate imported data
                    if (!importedData.accounts || !importedData.transactions) {
                        showToast('தவறான கோப்பு வடிவம்!', 'error');
                        return;
                    }
                    
                    // Store imported data temporarily
                    window.tempImportedData = importedData;
                    showToast('கோப்பு படிக்கப்பட்டது. "தரவு இறக்குமதி செய்" கிளிக் செய்யவும்.', 'success');
                } catch (error) {
                    showToast('கோப்பு படிக்க முடியவில்லை!', 'error');
                }
            };
            reader.readAsText(file);
        }
        
        // Import data from JSON file
        function importData() {
            if (!window.tempImportedData) {
                showToast('முதலில் கோப்பை தேர்ந்தெடுக்கவும்!', 'error');
                return;
            }
            
            const replace = document.getElementById('replaceData').checked;
            
            if (replace) {
                // Replace all data
                accounts = window.tempImportedData.accounts;
                transactions = window.tempImportedData.transactions;
            } else {
                // Merge data
                const existingIds = new Set(accounts.map(acc => acc.id));
                window.tempImportedData.accounts.forEach(account => {
                    if (!existingIds.has(account.id)) {
                        accounts.push(account);
                    }
                });
                
                const existingTransactionIds = new Set(transactions.map(t => t.id));
                window.tempImportedData.transactions.forEach(transaction => {
                    if (!existingTransactionIds.has(transaction.id)) {
                        transactions.push(transaction);
                    }
                });
            }
            
            saveData();
            renderAccounts();
            renderAllTransactions();
            renderAccountTransactions();
            updateDashboard();
            
            delete window.tempImportedData;
            document.getElementById('importFile').value = '';
            
            showToast('தரவு வெற்றிகரமாக இறக்குமதி செய்யப்பட்டது!', 'success');
            closeImportExportModal();
        }
        
        // Create backup
        function createBackup() {
            const backupData = {
                accounts: accounts,
                transactions: transactions,
                backupDate: new Date().toISOString(),
                backupType: 'manual'
            };
            
            localStorage.setItem('tamilAccountingBackup', JSON.stringify(backupData));
            showToast('காப்புப்பிரதி எடுக்கப்பட்டது!', 'success');
            
            // Show backup info
            viewBackupInfo();
        }
        
        // Restore from backup
        function restoreBackup() {
            const backupData = localStorage.getItem('tamilAccountingBackup');
            if (!backupData) {
                showToast('காப்புப்பிரதி இல்லை!', 'error');
                return;
            }
            
            if (confirm('காப்புப்பிரதியிலிருந்து மீட்டெடுக்க விரும்புகிறீர்களா? தற்போதைய தரவு மாற்றப்படும்!')) {
                try {
                    const backup = JSON.parse(backupData);
                    accounts = backup.accounts;
                    transactions = backup.transactions;
                    
                    saveData();
                    renderAccounts();
                    renderAllTransactions();
                    renderAccountTransactions();
                    updateDashboard();
                    
                    showToast('காப்புப்பிரதியிலிருந்து மீட்டெடுக்கப்பட்டது!', 'success');
                } catch (error) {
                    showToast('காப்புப்பிரதியை மீட்டெடுக்க முடியவில்லை!', 'error');
                }
            }
        }
        
        // View backup info
        function viewBackupInfo() {
            const backupData = localStorage.getItem('tamilAccountingBackup');
            const infoDiv = document.getElementById('backupInfo');
            
            if (!backupData) {
                infoDiv.innerHTML = '<p class="tamil-text" style="color: #666;">காப்புப்பிரதி இல்லை</p>';
                infoDiv.style.display = 'block';
                return;
            }
            
            try {
                const backup = JSON.parse(backupData);
                infoDiv.innerHTML = `
                    <p class="tamil-text"><strong>காப்புப்பிரதி தேதி:</strong> ${new Date(backup.backupDate).toLocaleString('ta-IN')}</p>
                    <p class="tamil-text"><strong>கணக்குகள்:</strong> ${backup.accounts.length}</p>
                    <p class="tamil-text"><strong>பரிமாற்றங்கள்:</strong> ${backup.transactions.length}</p>
                    <p class="tamil-text"><strong>வகை:</strong> ${backup.backupType === 'manual' ? 'கைமுறை' : 'தானியங்கி'}</p>
                `;
                infoDiv.style.display = 'block';
            } catch (error) {
                infoDiv.innerHTML = '<p class="tamil-text" style="color: #666;">காப்புப்பிரதி தகவலைப் படிக்க முடியவில்லை</p>';
                infoDiv.style.display = 'block';
            }
        }
        
        // PDF Export Functions
        function generatePDFReport() {
            const modal = document.getElementById('importExportModal');
            modal.style.display = 'flex';
            switchImportExportTab('export');
        }
        
        function exportCurrentAccountPDF() {
            if (!currentAccountId) {
                showToast('முதலில் கணக்கு தேர்ந்தெடுக்கவும்!', 'error');
                return;
            }
            
            const account = accounts.find(acc => acc.id === currentAccountId);
            if (!account) return;
            
            // Create printable content
            const printContent = document.createElement('div');
            printContent.style.padding = '20px';
            printContent.style.fontFamily = "'Latha', 'Tahoma', sans-serif";
            
            const accountTransactions = transactions.filter(t => t.accountId === currentAccountId);
            const income = accountTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expense = accountTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const balance = account.initialBalance + income - expense;
            
            printContent.innerHTML = `
                <h1 style="text-align: center; color: #2c3e50; margin-bottom: 30px;">${account.name} - கணக்கு அறிக்கை</h1>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                    <h2 style="color: #2c3e50;">கணக்கு விவரங்கள்</h2>
                    <p><strong>கணக்கு பெயர்:</strong> ${account.name}</p>
                    <p><strong>ஆரம்ப மீதி:</strong> ₹${account.initialBalance.toFixed(2)}</p>
                    <p><strong>மொத்த வரவு:</strong> ₹${income.toFixed(2)}</p>
                    <p><strong>மொத்த செலவு:</strong> ₹${expense.toFixed(2)}</p>
                    <p><strong>தற்போதைய மீதி:</strong> <span style="color: ${balance >= 0 ? '#27ae60' : '#e74c3c'}; font-weight: bold;">₹${balance.toFixed(2)}</span></p>
                    <p><strong>அறிக்கை தேதி:</strong> ${new Date().toLocaleDateString('ta-IN')}</p>
                </div>
                
                <h2 style="color: #2c3e50; margin-bottom: 20px;">பரிமாற்றங்கள்</h2>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #2c3e50; color: white;">
                            <th style="padding: 10px; text-align: left;">தேதி</th>
                            <th style="padding: 10px; text-align: left;">விவரம்</th>
                            <th style="padding: 10px; text-align: left;">வகை</th>
                            <th style="padding: 10px; text-align: left;">வகைப்பாடு</th>
                            <th style="padding: 10px; text-align: left;">தொகை</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${accountTransactions.map(transaction => `
                            <tr style="border-bottom: 1px solid #ddd;">
                                <td style="padding: 10px;">${new Date(transaction.date).toLocaleDateString('ta-IN')}</td>
                                <td style="padding: 10px;">${transaction.description}</td>
                                <td style="padding: 10px; color: ${transaction.type === 'income' ? '#27ae60' : '#e74c3c'}">
                                    ${transaction.type === 'income' ? 'வரவு' : 'செலவு'}
                                </td>
                                <td style="padding: 10px;">${transaction.category || '-'}</td>
                                <td style="padding: 10px; font-weight: bold; color: ${transaction.type === 'income' ? '#27ae60' : '#e74c3c'}">
                                    ₹${transaction.amount.toFixed(2)}
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                
                <div style="margin-top: 30px; text-align: center; color: #666; font-size: 0.9rem;">
                    <p>இந்த அறிக்கை Tamil Accounting Manager PRO மென்பொருளில் உருவாக்கப்பட்டது</p>
                    <p>தயாரிப்பு தேதி: ${new Date().toLocaleString('ta-IN')}</p>
                </div>
            `;
            
            // Generate PDF
            const opt = {
                margin: [10, 10, 10, 10],
                filename: `${account.name}_அறிக்கை_${new Date().toISOString().split('T')[0]}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            html2pdf().set(opt).from(printContent).save();
            showToast('PDF அறிக்கை பதிவிறக்கம் செய்யப்பட்டது!', 'success');
        }
        
        function exportAllAccountsPDF() {
            if (accounts.length === 0) {
                showToast('கணக்குகள் இல்லை!', 'error');
                return;
            }
            
            // Create printable content for all accounts
            const printContent = document.createElement('div');
            printContent.style.padding = '20px';
            printContent.style.fontFamily = "'Latha', 'Tahoma', sans-serif";
            
            // Calculate totals
            let totalInitial = 0;
            let totalIncome = 0;
            let totalExpense = 0;
            
            accounts.forEach(account => {
                const accountTransactions = transactions.filter(t => t.accountId === account.id);
                totalInitial += account.initialBalance;
                totalIncome += accountTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                totalExpense += accountTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            });
            
            const totalBalance = totalInitial + totalIncome - totalExpense;
            
            printContent.innerHTML = `
                <h1 style="text-align: center; color: #2c3e50; margin-bottom: 30px;">மொத்த கணக்கு அறிக்கை</h1>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                    <h2 style="color: #2c3e50;">மொத்த புள்ளிவிவரங்கள்</h2>
                    <p><strong>மொத்த கணக்குகள்:</strong> ${accounts.length}</p>
                    <p><strong>மொத்த ஆரம்ப மீதி:</strong> ₹${totalInitial.toFixed(2)}</p>
                    <p><strong>மொத்த வரவு:</strong> ₹${totalIncome.toFixed(2)}</p>
                    <p><strong>மொத்த செலவு:</strong> ₹${totalExpense.toFixed(2)}</p>
                    <p><strong>மொத்த மீதி:</strong> <span style="color: ${totalBalance >= 0 ? '#27ae60' : '#e74c3c'}; font-weight: bold;">₹${totalBalance.toFixed(2)}</span></p>
                    <p><strong>அறிக்கை தேதி:</strong> ${new Date().toLocaleDateString('ta-IN')}</p>
                </div>
                
                ${accounts.map(account => {
                    const accountTransactions = transactions.filter(t => t.accountId === account.id);
                    const income = accountTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                    const expense = accountTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
                    const balance = account.initialBalance + income - expense;
                    
                    return `
                        <div style="border: 2px solid #ddd; border-radius: 10px; padding: 20px; margin-bottom: 20px; page-break-inside: avoid;">
                            <h3 style="color: #2c3e50; border-bottom: 2px solid ${account.color}; padding-bottom: 10px;">
                                ${account.name} - ₹${balance.toFixed(2)}
                            </h3>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0;">
                                <div><strong>ஆரம்ப மீதி:</strong> ₹${account.initialBalance.toFixed(2)}</div>
                                <div><strong>வரவு:</strong> ₹${income.toFixed(2)}</div>
                                <div><strong>செலவு:</strong> ₹${expense.toFixed(2)}</div>
                                <div><strong>மீதி:</strong> <span style="color: ${balance >= 0 ? '#27ae60' : '#e74c3c'};">₹${balance.toFixed(2)}</span></div>
                            </div>
                            <p><strong>விளக்கம்:</strong> ${account.description || 'இல்லை'}</p>
                            <p><strong>பரிமாற்றங்கள்:</strong> ${accountTransactions.length}</p>
                        </div>
                    `;
                }).join('')}
                
                <div style="margin-top: 30px; text-align: center; color: #666; font-size: 0.9rem;">
                    <p>இந்த அறிக்கை Tamil Accounting Manager PRO மென்பொருளில் உருவாக்கப்பட்டது</p>
                    <p>தயாரிப்பு தேதி: ${new Date().toLocaleString('ta-IN')}</p>
                </div>
            `;
            
            // Generate PDF
            const opt = {
                margin: [10, 10, 10, 10],
                filename: `அனைத்து_கணக்குகள்_அறிக்கை_${new Date().toISOString().split('T')[0]}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            html2pdf().set(opt).from(printContent).save();
            showToast('அனைத்து கணக்குகளின் PDF அறிக்கை பதிவிறக்கம் செய்யப்பட்டது!', 'success');
        }
        
        function exportAccountPDF(accountId) {
            const originalAccount = currentAccountId;
            currentAccountId = accountId;
            exportCurrentAccountPDF();
            currentAccountId = originalAccount;
        }
        
        // Print report
        function printReport() {
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>கணக்கு அறிக்கை</title>
                    <style>
                        body { font-family: 'Latha', 'Tahoma', sans-serif; padding: 20px; }
                        h1 { color: #2c3e50; text-align: center; }
                        .account-card { border: 1px solid #000; padding: 15px; margin-bottom: 20px; page-break-inside: avoid; }
                        .transaction-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
                        .transaction-table th, .transaction-table td { border: 1px solid #000; padding: 8px; }
                        .summary { background: #f0f0f0; padding: 15px; margin-bottom: 20px; }
                    </style>
                </head>
                <body>
                    <h1>கணக்கு அறிக்கை - ${new Date().toLocaleDateString('ta-IN')}</h1>
                    
                    <div class="summary">
                        <h2>மொத்த புள்ளிவிவரங்கள்</h2>
                        <p><strong>மொத்த கணக்குகள்:</strong> ${accounts.length}</p>
                        <p><strong>மொத்த வரவு:</strong> ₹${accounts.reduce((sum, acc) => sum + acc.initialBalance, 0) + transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0)}</p>
                        <p><strong>மொத்த செலவு:</strong> ₹${transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0)}</p>
                    </div>
                    
                    ${accounts.map(account => {
                        const accountTransactions = transactions.filter(t => t.accountId === account.id);
                        const income = accountTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                        const expense = accountTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
                        const balance = account.initialBalance + income - expense;
                        
                        return `
                            <div class="account-card">
                                <h3>${account.name} - ₹${balance.toFixed(2)}</h3>
                                <p><strong>ஆரம்ப மீதி:</strong> ₹${account.initialBalance.toFixed(2)}</p>
                                <p><strong>வரவு:</strong> ₹${income.toFixed(2)}</p>
                                <p><strong>செலவு:</strong> ₹${expense.toFixed(2)}</p>
                                <p><strong>பரிமாற்றங்கள்:</strong> ${accountTransactions.length}</p>
                            </div>
                        `;
                    }).join('')}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        // Share via WhatsApp
        function shareViaWhatsApp() {
            if (accounts.length === 0) {
                showToast('கணக்குகள் இல்லை!', 'error');
                return;
            }
            
            let message = `📊 கணக்கு சுருக்கம் - ${new Date().toLocaleDateString('ta-IN')}\n\n`;
            
            // Add account summaries
            accounts.forEach((account, index) => {
                const accountTransactions = transactions.filter(t => t.accountId === account.id);
                const income = accountTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
                const expense = accountTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
                const balance = account.initialBalance + income - expense;
                
                message += `${index + 1}. ${account.name}: ₹${balance.toFixed(2)}\n`;
            });
            
            // Add totals
            const totalIncome = accounts.reduce((sum, acc) => sum + acc.initialBalance, 0) + 
                               transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalExpense = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const totalBalance = totalIncome - totalExpense;
            
            message += `\n📈 மொத்த வரவு: ₹${totalIncome.toFixed(2)}`;
            message += `\n📉 மொத்த செலவு: ₹${totalExpense.toFixed(2)}`;
            message += `\n💰 மொத்த மீதி: ₹${totalBalance.toFixed(2)}`;
            message += `\n\nTamil Accounting Manager PRO மென்பொருளில் உருவாக்கப்பட்டது`;
            
            // Encode message for WhatsApp
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
            
            // Open WhatsApp
            window.open(whatsappUrl, '_blank');
        }
        
        // Clear all data
        function clearAllData() {
            if (confirm('நீங்கள் அனைத்து தரவையும் நிரந்தரமாக நீக்க விரும்புகிறீர்களா? இந்த செயலை மீளமுடியாது!')) {
                accounts = [];
                transactions = [];
                currentAccountId = null;
                
                localStorage.removeItem('tamilAccountsPro');
                localStorage.removeItem('tamilTransactionsPro');
                
                renderAccounts();
                renderAllTransactions();
                renderAccountTransactions();
                updateDashboard();
                
                showToast('அனைத்து தரவும் நீக்கப்பட்டது!', 'success');
            }
        }
        
        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.className = 'toast';
            toast.classList.add(type);
            
            // Show toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // Hide toast after 3 seconds
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>